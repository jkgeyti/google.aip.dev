{"text": "---\nid: 217\nstate: approved\ncreated: 2019-08-26\nplacement:\n  category: design-patterns\n  order: 130\n---\n\n# Unreachable resources\n\nOccasionally, a user may ask for a list of resources, and some set of resources\nin the list are temporarily unavailable. For example, a user may ask to list\nresources across multiple parent locations, but one of those locations is\ntemporarily unreachable. In this situation, it is still desirable to provide\nthe user with all the available resources, while indicating that something is\nmissing.\n\n## Guidance\n\nIf a method to retrieve data is capable of partially failing due to one or more\nresources being temporarily unreachable, the response message **must** include\na field to indicate this:\n\n```proto\nmessage ListBooksResponse {\n  // The books matching the request.\n  repeated Book books = 1;\n\n  // The next page token, if there are more books matching the\n  // request.\n  string next_page_token = 2;\n\n  // Unreachable resources.\n  repeated string unreachable = 3;\n}\n```\n\n- The field **must** be a repeated string, and **should** be named\n  `unreachable`.\n- The field **must** be set to the names of the resources which are the cause\n  of the issue, such as the parent or individual resources that could not be\n  reached. The objects listed as unreachable **may** be _parents_ (or higher\n  ancestors) rather than the individual resources being requested. For example,\n  if a location is unreachable, the location is listed.\n  - The response **must not** provide any other information about the issue,\n    such as error details or codes. To discover what the underlying issue is,\n    users **should** send a more specific request.\n  - The service **must** provide a way for the user to get an error with\n    additional information, and **should** allow the user to repeat the\n    original call with more restrictive parameters in order to do so.\n  - The resource names provided in this field **may** be heterogeneous. The\n    field **should** document what potential resources may be provided in this\n    field, and note that it might expand later.\n\n**Important:** If a single unreachable location or resource prevents returning\nany data by definition (for example, a list request for a single publisher\nwhere that publisher is unreachable), the service **must** fail the entire\nrequest with an error.\n\n### Pagination\n\nWhen paginating over a list, it is likely that the service will not know that\nthere are unreachable parents or resources initially. Further, parents may\nalternate between being available and unavailable in unpredictable ways\nthroughout the process of listing all the requested resources.\n\nThese facts lead to the following guidance:\n\n- The response **must** provide any outstanding unreachable locations or\n  resources in the `unreachable` field on pages _following_ the final page that\n  contains a resource.\n  - The response **should not** include both requested data and unreachable\n    resources on the same page.\n    - For example, if there are two pages of books and one unavailable\n      publisher, there should be three pages total: first the two pages of\n      books, and then a final page with no books and the unavailable publisher.\n  - If the number of unreachable resources to list is very large, the response\n    **should** honor the `page_size` field in the same way as for resources. In\n    this case, all pages with requested information **should** precede all\n    pages with unavailable resources or locations.\n  - The final page's `unreachable` field **must** _only_ include resources or\n    parents that were partially provided (or missing completely) across the\n    entirety of the pagination process.\n    - For example, if a parent or resource was unreachable at the beginning of\n      pagination and it became reachable again and the entire set of previously\n      unreachable data was provided to the user on any page, the `unreachable`\n      field **must not** include the intermittently-unreachable parent or\n      resource.\n    - On the other hand, if only _some_ of the resources for a given parent are\n      provided during such an incident as described above, the parent or\n      resource **must** be included in the `unreachable` field.\n\n## Further reading\n\n- For listing across collections, see [AIP-159][].\n\n[aip-159]: ./0159.md\n"}