{"text": "---\nid: 152\nstate: approved\ncreated: 2020-04-27\nupdated: 2022-06-02\nplacement:\n  category: design-patterns\n  order: 10\n---\n\n# Jobs\n\nOccasionally, APIs may need to expose a task that takes significant time to\ncomplete, and where a transient [long-running operation][aip-151] is not\nappropriate. For example, a task could need to run repeatedly, or have separate\npermissions for configuring the task as opposed to running it.\n\n## Guidance\n\nAn API **may** define a `Job` resource to represent a particular task with\ndistinct setup, configuration, and execution:\n\n```proto\nmessage WriteBookJob {\n  option (google.api.resource) = {\n    type: \"library.googleapis.com/WriteBookJob\"\n    pattern: \"publishers/{publisher}/writeBookJobs/{write_book_job}\"\n  };\n\n  // Name and other fields...\n}\n```\n\n- The name of the resource **must** end with the word \"Job\".\n  - The prefix **should** be a valid RPC name, with a verb and a noun.\n- The service **should** define all five of the standard methods (AIP-131,\n  AIP-132, AIP-133, AIP-134, AIP-135), and use them as the\n  primary way to configure the job.\n\n### Run method\n\nThe service **should** define a `Run` custom method that executes the job\nimmediately:\n\n```proto\nrpc RunWriteBookJob(RunWriteBookJobRequest)\n    returns (google.longrunning.Operation) {\n  option (google.api.http) = {\n    post: \"/v1/{name=publishers/*/writeBookJobs/*}:run\"\n    body: \"*\"\n  };\n  option (google.longrunning.operation_info) = {\n    response_type: \"RunWriteBookJobResponse\"\n    metadata_type: \"RunWriteBookJobMetadata\"\n  };\n}\n```\n\n- The RPC's name **must** begin with the word `Run`. The remainder of the\n  RPC name **should** be the singular form of the job resource being run.\n- The request message **must** match the RPC name, with a `Request` suffix.\n- The method **should** return a [long-running operation][aip-151], which\n  **must** resolve to a response message that includes the result of running\n  the job.\n  - The response message name must match the RPC name, with a `Response`\n    suffix.\n  - The method **may** use any metadata message it wishes.\n- The HTTP verb **must** be `POST`, as is usual for [custom methods][aip-136].\n- The body clause in the `google.api.http` annotation **should** be `\"*\"`.\n- The URI path **should** contain a single `name` variable corresponding to the\n  name of the job resource being run.\n- The URI path **must** end with `:run`.\n- Errors that prevent execution of the job from _starting_ **must** return an\n  error response (AIP-193), similar to any other method. Errors that occur\n  over the course of the job execution **may** be placed in the metadata\n  message. The errors themselves **must** still be represented with a\n  [`google.rpc.Status`][status] object.\n\n### Run request message\n\nRun methods implement a common request message pattern:\n\n```proto\nmessage RunWriteBookJobRequest {\n  // The name of the job to run.\n  string name = 1 [\n    (google.api.field_behavior) = REQUIRED,\n    (google.api.resource_reference) = {\n      type: \"library.googleapis.com/WriteBookJob\"\n    }];\n}\n```\n\n- A singular `string name` field **must** be included.\n  - The field **should** be [annotated as required][aip-203].\n  - The field **should** identify the [resource type][aip-123] that it\n    references.\n\n### Executions and results\n\nOrdinarily, the API **should** provide results to the user as the final\nresponse of the `Run` method. However, this is sometimes insufficient; for\nexample, a job that runs on a recurring schedule in the background can not\ndeliver results to the user in this way.\n\nThe service **may** store resources representing individual executions along\nwith their result as a sub-collection of resources under the job, which allows\nthe user to list *past* job executions. A service that does this **should**\ndefine the `Get`, `List`, and `Delete` methods for the execution resources:\n\n```proto\nmessage WriteBookJobExecution {\n  option (google.api.resource) = {\n    type: \"library.googleapis.com/WriteBookJobExecution\"\n    pattern: \"publishers/{publisher}/writeBookJobs/{write_book_job}/executions/{execution}\"\n  };\n\n  // Name and other information about the execution, such as metadata, the\n  // result, error information, etc.\n}\n```\n\nIn this case, the operation returned by job's `Run` method **should** refer to\nthe child resource.\n\n## Changelog\n\n- **2022-06-02:** Changed suffix descriptions to eliminate superfluous \"-\".\n- **2020-11-02**: Expanded guidance on HTTP, field behavior, and resource\n  reference annotations and request format.\n\n<!-- prettier-ignore-start -->\n[aip-123]: ./0123.md\n[aip-136]: ./0136.md\n[aip-151]: ./0151.md\n[aip-203]: ./0203.md\n[status]: https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto\n<!-- prettier-ignore-end -->\n"}