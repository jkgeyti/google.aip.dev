{"text": "---\nid: 235\nstate: approved\ncreated: 2019-06-18\nupdated: 2022-06-02\nplacement:\n  category: operations\n  order: 230\n---\n\n# Batch methods: Delete\n\nSome APIs need to allow users to delete a set of resources in a single\ntransaction. A batch delete method provides this functionality.\n\n## Guidance\n\nBatch delete methods are specified using the following pattern:\n\n```proto\nrpc BatchDeleteBooks(BatchDeleteBooksRequest) returns (google.protobuf.Empty) {\n  option (google.api.http) = {\n    post: \"/v1/{parent=publishers/*}/books:batchDelete\"\n    body: \"*\"\n  };\n}\n```\n\n- The RPC's name **must** begin with `BatchDelete`. The remainder of the RPC\n  name **should** be the plural form of the resource being deleted.\n- The request message **must** match the RPC name, with a `Request` suffix.\n- The response message **should** be `google.protobuf.Empty`.\n  - If the resource is [soft deleted][soft-delete], the response message\n    **should** be a response message containing the updated resources.\n  - In the event that the request may take a significant amount of time, the\n    response message **must** be a `google.longrunning.Operation` which\n    resolves to the correct response.\n- The HTTP verb **must** be `POST` (not `DELETE`).\n- The HTTP URI **must** end with `:batchDelete`.\n- The URI path **should** represent the collection for the resource, matching\n  the collection used for simple CRUD operations. If the operation spans\n  parents, a dash (`-`) **may** be accepted as a wildcard.\n- The body clause in the `google.api.http` annotation **should** be `\"*\"`.\n- The operation **should** be atomic: it **should** fail for all resources or\n  succeed for all resources (no partial success).\n  - If the operation covers multiple locations and at least one location is\n    down, the operation **must** fail.\n\n### Request message\n\nThe request for a batch delete method **should** be specified with the\nfollowing pattern:\n\n```proto\nmessage BatchDeleteBooksRequest {\n  // The parent resource shared by all books being deleted.\n  // Format: publishers/{publisher}\n  // If this is set, the parent of all of the books specified in `names`\n  // must match this field.\n  string parent = 1 [\n    (google.api.resource_reference) = {\n      child_type: \"library.googleapis.com/Book\"\n    }];\n\n  // The names of the books to delete.\n  // A maximum of 1000 books can be deleted in a batch.\n  // format: publishers/{publisher}/books/{book}\n  repeated string names = 2 [\n    (google.api.field_behavior) = REQUIRED,\n    (google.api.resource_reference) = {\n      type: \"library.googleapis.com/Book\"\n    }];\n}\n```\n\n- A `parent` field **should** be included, unless the resource being deleted is\n  a top-level resource. If a caller sets this field, and the\n  parent collection in the name of any resource being deleted does not match,\n  the request **must** fail.\n  - This field **should** be required if only 1 parent per request is allowed.\n  - The field **should** identify the [resource type][aip-122-parent] that it\n    references.\n  - The comment for the field **should** document the resource pattern.\n- The request message **must** include a repeated field which accepts the\n  resource names specifying the resources to delete. The field **should** be\n  named `names`.\n  - The field **should** be required.\n  - The field **should** identify the [resource type][aip-122-names] that it\n    references.\n  - The comment for the field **should** document the resource pattern.\n- Other fields besides `name` **may** be \"hoisted\" from the [standard Delete\n  request][request-message]. There is no way to allow for these fields to\n  accept different values for different resources; if this is needed, use the\n  [alternative request message form](#request-message-containing-standard-delete-request-messages).\n- The request message **must not** contain any other required fields, and\n  **should not** contain other optional fields except those described in this\n  or another AIP.\n- The comment above the `names` field **should** document the maximum number of\n  requests allowed.\n- Filter-based matching **must not** be supported.\n\n### Request message containing standard delete request messages\n\nIf the [standard Delete request message][request-message] contains a field\nbesides the resource name that needs to be different between different\nresources being requested, the batch message **may** alternatively hold a\n`repeated` field of the [standard Delete request message][request-message].\nThis is generally discouraged unless your use case really requires it.\n\nThe request for a batch delete method **should** be specified with the\nfollowing pattern:\n\n```proto\nmessage BatchDeleteBooksRequest {\n  // The parent resource shared by all books being deleted.\n  // Format: publishers/{publisher}\n  // If this is set, the parent of all of the books specified in the\n  // DeleteBookRequest messages must match this field.\n  string parent = 1 [\n    (google.api.resource_reference) = {\n      child_type: \"library.googleapis.com/Book\"\n    }];\n\n  // The requests specifying the books to delete.\n  // A maximum of 1000 books can be deleted in a batch.\n  repeated DeleteBookRequest requests = 2\n    [(google.api.field_behavior) = REQUIRED];\n}\n```\n\n- A `parent` field **should** be included. If a caller sets this field, and the\n  parent collection in the name of any resource being deleted does not match,\n  the request **must** fail.\n  - This field **should** be required if only 1 parent per request is allowed.\n  - The field **should** identify the [resource type][aip-122-parent] that it\n    references.\n  - The comment for the field **should** document the resource pattern.\n- The request message **must** include a repeated field which accepts the\n  request messages specifying the resources to delete, as specified for\n  [standard Delete methods][request-message]. The field **should** be named\n  `requests`.\n  - The field **should** be required.\n- Other fields **may** be \"hoisted\" from the [standard Delete\n  request][request-message], which means that the field can be set at either\n  the batch level or child request level. Similar to `parent`, if both the\n  batch level and child request level are set for the same field, the values\n  **must** match.\n  - Fields which must be unique cannot be hoisted (e.g. `etag`).\n- The request message **must not** contain any other required fields, and\n  **should not** contain other optional fields except those described in this\n  or another AIP.\n- The comment above the `requests` field **should** document the maximum number\n  of requests allowed.\n- Filter-based matching **must not** be supported unless it is infeasible to\n  support critical use cases without it, because it makes it too easy for users\n  to accidentally delete important data. If it is unavoidable, see [AIP-165][].\n\n### Response message (soft-delete only)\n\nIn the case where a response message is necessary because the resource is\nsoft-deleted, the response **should** be specified with the following pattern:\n\n```proto\nmessage BatchDeleteBooksResponse {\n  // Books deleted.\n  repeated Book books = 1;\n}\n```\n\n- The response message **must** include one repeated field corresponding to the\n  resources that were soft-deleted.\n\n[aip-122-names]: ./0122.md#fields-representing-resource-names\n[aip-122-parent]: ./0122.md#fields-representing-a-resources-parent\n[aip-165]: ./0165.md\n[request-message]: ./0135.md#request-message\n[soft-delete]: ./0135.md#soft-delete\n\n## Changelog\n\n- **2022-06-02:** Changed suffix descriptions to eliminate superfluous \"-\".\n- **2020-09-16**: Suggested annotating `parent`, `names`, and `requests` fields.\n- **2020-08-27**: Removed parent recommendations for top-level resources.\n- **2020-03-27**: Added reference to AIP-165 for criteria-based deletion.\n- **2019-10-11**: Changed the primary recommendation to specify a repeated\n  string instead of a repeated standard Delete message. Moved the original\n  recommendation into its own section.\n- **2019-09-11**: Fixed the wording about which child field the `parent` field\n  should match.\n- **2019-08-01**: Changed the examples from \"shelves\" to \"publishers\", to\n  present a better example of resource ownership.\n"}