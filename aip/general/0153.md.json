{"text":"---\nid: 153\nstate: approved\ncreated: 2019-12-16\nplacement:\n  category: design-patterns\n  order: 20\n---\n\n# Import and export\n\nMany users want to be able to load data into an API, or get their existing data\nout of an API. This is particularly important for enterprise users, who are\noften concerned about vendor lock-in.\n\n## Guidance\n\nAPIs **may** support import and export operations, which **may** create\nmultiple new resources, or they **may** populate data into a single resource.\n\n### Multiple resources\n\nServices **may** support importing and exporting multiple resources into or out\nof an API, and **should** implement a common pattern to do so:\n\n```proto\nrpc ImportBooks(ImportBooksRequest) returns (google.longrunning.Operation) {\n  option (google.api.http) = {\n    post: \"/v1/{parent=publishers/*}/books:import\"\n    body: \"*\"\n  };\n  option (google.longrunning.operation_info) = {\n    response_type: \"ImportBooksResponse\"\n    metadata_type: \"ImportBooksMetadata\"\n  };\n}\n\nrpc ExportBooks(ExportBooksRequest) returns (google.longrunning.Operation) {\n  option (google.api.http) = {\n    post: \"/v1/{parent=publishers/*}/books:export\"\n    body: \"*\"\n  };\n  option (google.longrunning.operation_info) = {\n    response_type: \"ExportBooksResponse\"\n    metadata_type: \"ExportBooksMetadata\"\n  };\n}\n```\n\n- The method **must** return a long-running operation (see [AIP-151][]) unless\n  the service can guarantee that it will _never_ need more than a few seconds\n  to complete.\n- The HTTP verb **must** be `POST`, and the `body` **must** be `\"*\"`.\n- A `parent` field **should** be included as part of the URI.\n  - If importing into or exporting from multiple resources is required, the API\n    **should** keep the `parent` field and allow the user to use the `-`\n    character to indicate multiple parents (see [AIP-159][]).\n  - On import, if the user provides a specific parent, the API **must** reject\n    any imported resources that would be added to a different parent.\n- The URI suffix **should** be `:import` or `:export`.\n\n### Data for a single resource\n\nServices **may** support importing and exporting data into or out of a single\nresource, and **should** implement a common pattern to do so:\n\n```proto\nrpc ImportPages(ImportPagesRequest) returns (google.longrunning.Operation) {\n  option (google.api.http) = {\n    post: \"/v1/{book=publishers/*/books/*}:importPages\"\n    body: \"*\"\n  };\n  option (google.longrunning.operation_info) = {\n    response_type: \"ImportPagesResponse\"\n    metadata_type: \"ImportPagesMetadata\"\n  };\n}\n\nrpc ExportPages(ExportPagesRequest) returns (google.longrunning.Operation) {\n  option (google.api.http) = {\n    post: \"/v1/{book=publishers/*/books/*}:exportPages\"\n    body: \"*\"\n  };\n  option (google.longrunning.operation_info) = {\n    response_type: \"ExportPagesResponse\"\n    metadata_type: \"ExportPagesMetadata\"\n  };\n}\n```\n\n- The method **must** return a long-running operation (see [AIP-151][]) unless\n  the service can guarantee that it will _never_ need more than a few seconds\n  to complete.\n- The HTTP verb **must** be `POST`, and the `body` **must** be `\"*\"`.\n- A field representing the resource that data is being imported into **should**\n  be included as part of the URI. The field **should** be named after the\n  resource (and **should not** be called `name`).\n- The URI suffix should include both the verb and a noun for the data itself,\n  such as `:importPages` or `:exportPages`.\n\n### Request object\n\nImports and exports often require two fundamentally different types of\nconfiguration:\n\n1. Configuration specific to the source or destination.\n2. Configuration regarding the imported or exported data itself.\n\nSource or destination configuration should be grouped into a single message and\nplaced inside a oneof:\n\n```proto\nmessage ImportBooksRequest {\n  string parent = 1 [\n    (google.api.field_behavior) = REQUIRED,\n    (google.api.resource_reference) = {\n      child_type: \"library.googleapis.com/Book\"\n    }];\n  oneof source {\n    AuthorSource author_source = 2;\n    TranslatorSource translator_source = 3;\n  }\n  string isbn_prefix = 4;\n}\n\nmessage ExportBooksRequest {\n  string parent = 1 [\n    (google.api.field_behavior) = REQUIRED,\n    (google.api.resource_reference) = {\n      child_type: \"library.googleapis.com/Book\"\n    }];\n  oneof destination {\n    PrinterDestination printer_destination = 2;\n    TranslatorDestination translator_destination = 3;\n  }\n  string filter = 4;\n}\n```\n\n- The source configuration messages **must** be placed within a `oneof source`\n  (for import) or `oneof destination` (for export), even if there is only one.\n  (This maintains flexibility to add more later.)\n- Configuration related to the data itself (and therefore common across all\n  sources) **must** be placed at the top-level of the request message.\n\n**Note:** The configuration for import and export **may** be different from one\nanother. (For example, it would be sensible to import from a file but export to\na directory.)\n\n### Inline sources\n\nAPIs **may** also permit import and export \"inline\", where the contents to be\nimported or exported are provided in the request or response.\n\n```proto\nmessage InlineSource {\n  repeated Book books = 1;\n}\n```\n\n- The source or destination **should** be named `InlineSource` or\n  `InlineDestination`.\n- The message **should** include a repeated field representing the resource.\n  However, if the resource structure is complex, the API **may** use a separate\n  inline representation. In this situation, the same format **must** be used\n  for both import and export.\n\n### Partial failures\n\nWhile partial failures are normally discouraged, import and export RPCs\n**should** include partial failure information in the metadata object. Each\nindividual error **should** be a `google.rpc.Status` object describing the\nerror. For more on errors, see [AIP-193][].\n\n[aip-151]: ./0151.md\n[aip-159]: ./0159.md\n[aip-193]: ./0193.md\n[google bigquery]: https://cloud.google.com/bigquery\n[google storage]: https://cloud.google.com/storage\n"}
