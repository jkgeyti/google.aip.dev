{"text":"---\nid: 231\nstate: approved\ncreated: 2019-06-18\nupdated: 2022-06-02\nplacement:\n  category: operations\n  order: 200\n---\n\n# Batch methods: Get\n\nSome APIs need to allow users to get a specific set of resources at a\nconsistent time point (e.g. using a read transaction). A batch get method\nprovides this functionality.\n\n## Guidance\n\nAPIs **may** support Batch Get using the following pattern:\n\n```proto\nrpc BatchGetBooks(BatchGetBooksRequest) returns (BatchGetBooksResponse) {\n  option (google.api.http) = {\n    get: \"/v1/{parent=publishers/*}/books:batchGet\"\n  };\n}\n```\n\n- The RPC's name **must** begin with `BatchGet`. The remainder of the RPC name\n  **should** be the plural form of the resource being retrieved.\n- The request and response messages **must** match the RPC name, with\n  `Request` and `Response` suffixes.\n- The HTTP verb **must** be `GET`.\n- The HTTP URI **must** end with `:batchGet`.\n- The URI path **should** represent the collection for the resource, matching\n  the collection used for simple CRUD operations. If the operation spans\n  parents, a dash (`-`) **may** be accepted as a wildcard.\n- There **must not** be a body key in the `google.api.http` annotation.\n- The operation **must** be atomic: it **must** fail for all resources or\n  succeed for all resources (no partial success). For situations requiring\n  partial failures, `List` ([AIP-132][]) methods **should** be used.\n  - If the operation covers multiple locations and at least one location is\n    down, the operation **must** fail.\n\n### Request message\n\nThe request for a batch get method **should** be specified with the following\npattern:\n\n```proto\nmessage BatchGetBooksRequest {\n  // The parent resource shared by all books being retrieved.\n  // Format: publishers/{publisher}\n  // If this is set, the parent of all of the books specified in `names`\n  // must match this field.\n  string parent = 1 [\n    (google.api.resource_reference) = {\n      child_type: \"library.googleapis.com/Book\"\n    }];\n\n  // The names of the books to retrieve.\n  // A maximum of 1000 books can be retrieved in a batch.\n  // Format: publishers/{publisher}/books/{book}\n  repeated string names = 2 [\n    (google.api.field_behavior) = REQUIRED,\n    (google.api.resource_reference) = {\n      type: \"library.googleapis.com/Book\"\n    }];\n}\n```\n\n- A `parent` field **should** be included, unless the resource being retrieved\n  is a top-level resource, to facilitate inclusion in the URI as\n  well to permit a single permissions check. If a caller sets this field, and\n  the parent collection in the name of any resource being retrieved does not\n  match, the request **must** fail.\n  - This field **should** be required if only 1 parent per request is allowed.\n  - The field **should** identify the [resource type][aip-122-parent] that it\n    references.\n  - The comment for the field **should** document the resource pattern.\n- The request message **must** include a repeated field which accepts the\n  resource names specifying the resources to retrieve. The field **should** be\n  named `names`.\n  - If no resource names are provided, the API **should** error with\n    `INVALID_ARGUMENT`.\n  - The field **should** be required.\n  - The field **should** identify the [resource type][aip-122-names] that it\n    references.\n  - The comment for the field **should** document the resource pattern.\n- Other fields besides `name` **may** be \"hoisted\" from the [standard Get\n  request][request-message]. There is no way to allow for these fields to\n  accept different values for different resources; if this is needed, use the\n  [alternative request message form](#nested-request-objects).\n- Batch get **should not** support pagination because transactionality across\n  API calls would be extremely difficult to implement or enforce, and the\n  request defines the exact scope of the response anyway.\n- The request message **must not** contain any other required fields, and\n  **should not** contain other optional fields except those described in this\n  or another AIP.\n- The comment above the `names` field **should** document the maximum number of\n  requests allowed.\n\n### Response message\n\nThe response for a batch get method **should** be specified with the following\npattern:\n\n```proto\nmessage BatchGetBooksResponse {\n  // Books requested.\n  repeated Book books = 1;\n}\n```\n\n- The response message **must** include one repeated field corresponding to the\n  resources being retrieved.\n- The order of books in the response **must** be the same as the names in the\n  request.\n\n[aip-122-names]: ./0122.md#fields-representing-resource-names\n[aip-122-parent]: ./0122.md#fields-representing-a-resources-parent\n[request-message]: ./0131.md#request-message\n\n### Nested request objects\n\nIf the [standard Get request message][request-message] contains a field besides\nthe resource name that needs to be different between different resources being\nrequested, the batch message **may** alternatively hold a `repeated` field of\nthe [standard Get request message][request-message]. This is generally\ndiscouraged unless your use case really requires it.\n\nThe request for a batch get method using this approach **should** be specified\nwith the following pattern:\n\n```proto\nmessage BatchGetBooksRequest {\n  // The parent resource shared by all books being retrieved.\n  // Format: publishers/{publisher}\n  // If this is set, the parent field in the GetBookRequest messages\n  // must either be empty or match this field.\n  string parent = 1 [\n    (google.api.resource_reference) = {\n      child_type: \"library.googleapis.com/Book\"\n    }];\n\n  // The requests specifying the books to retrieve.\n  // A maximum of 1000 books can be retrieved in a batch.\n  repeated GetBookRequest requests = 2\n    [(google.api.field_behavior) = REQUIRED];\n}\n```\n\n- A `parent` field **should** be included. If a caller sets this field, and the\n  parent collection in the name of any resource being retrieved does not match,\n  the request **must** fail.\n  - This field **should** be required if only 1 parent per request is allowed.\n  - The field **should** identify the [resource type][aip-122-parent] that it\n    references.\n  - The comment for the field **should** document the resource pattern.\n- The request message **must** include a repeated field which accepts the\n  request messages specifying the resources to retrieve, as specified for\n  [standard Get methods][request-message]. The field **should** be named\n  `requests`.\n  - The field **should** be required.\n- Other fields **may** be \"hoisted\" from the [standard Get\n  request][request-message], which means that the field can be set at either\n  the batch level or child request level. Similar to `parent`, if both the\n  batch level and child request level are set for the same field, the values\n  **must** match.\n- Batch get **should not** support pagination because transactionality across\n  API calls would be extremely difficult to implement or enforce, and the\n  request defines the exact scope of the response anyway.\n- The request message **must not** contain any other required fields, and\n  **should not** contain other optional fields except those described in this\n  or another AIP.\n- The comment above the `requests` field **should** document the maximum number\n  of requests allowed.\n\n[aip-132]: https://aip.dev/132\n\n## Changelog\n\n- **2022-06-02:** Changed suffix descriptions to eliminate superfluous \"-\".\n- **2020-09-16**: Suggested annotating `parent`, `names`, and `requests` fields.\n- **2020-08-27**: Removed parent recommendations for top-level resources.\n- **2020-03-24**: Clarified behavior if no resource names are sent.\n- **2019-09-11**: Changed the primary recommendation to specify a repeated\n  string instead of a repeated standard Get request message. Moved the original\n  recommendation into its own section.\n- **2019-08-01**: Changed the examples from \"shelves\" to \"publishers\", to\n  present a better example of resource ownership.\n"}
